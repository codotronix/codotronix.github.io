/*!
 * barick-tilify v1.0.0 (https://github.com/codotronix/barick-tilify)
 * Copyright 2016 Suman Barick
 * Licensed under the MIT license
 */var tile_plugins={};!function($){$.fn.tilefy=function(config){return this.each(function(){var thisContainer=this,container=$(this),containerWidth=container.width(),tileOrder=config.TD.tileOrder,tiles=config.TD.tiles,grids={},gridsPerRow=0,page_Width_Class="xs",small_tile_size=0,medium_tile_size=0,big_tile_size=0,clearSpaceDivPosition=200,tileMovementAllowed=!1,tileResizeAllowed=!1,colorCodes=["#632F00","#B01E00","#C1004F","#4617B4","#008287","#199900","#00C13F","#FF2E12","#FF1D77","#AA40FF","#1FAEFF","#000","#00A3A3","#FE7C22"];function init(){calculateWidths(),makeGrids(),mapTilesToGrid(),drawTiles(),setStyles(),wakeUpLive(),bindDragAndDrop(),enableTileResize()}function reTilefy(){resetGrids(),mapTilesToGrid(),drawTiles(),setStyles()}function drawTiles(){var e,i="";for(var l in container.addClass("barick-tiles-container "+page_Width_Class),tiles)i+='<div id="'+(e=tiles[l]).id+'" class="tile '+e.size+" "+e.classes+'" style="top:'+e.top+"px; left:"+e.left+'px;" data-gridid="'+e.gridId+'" ><a class="tileInnerContainer" target="_blank" href="'+(e.link||"javascript:void(0)")+'" style="background: '+e.bgColor+';" >',"font"==e.iconType?i+='<span class="fontIcon '+e.icon+'"></span>':"live"==e.iconType?(i+='<div class="live">',null!=e.liveImgUrls&&(i+='<img  class="fontImg" src="'+e.liveImgUrls[0]+'" />'),null!=e.liveTxts&&(i+='<span class="liveTxt" style="color:'+e.fontColor+'">'+e.liveTxts[0]+"</span>"),i+="</div>"):"plugin"==e.iconType&&(i+='<div class="plugin"></div>'),i+='<label class="name">'+e.name+"</label>",i+="</a></div>";i+='<div style="position:absolute; left: 10px; right: 10px; height: 60px; top: '+clearSpaceDivPosition+'px" ></div>',container.html(i),loadPlugins()}function loadPlugins(){for(var i in tiles)"plugin"==tiles[i].iconType&&(tile_plugins[tiles[i].id]=tile_plugins[tiles[i].id]||{},tile_plugins[tiles[i].id].initFunc?eval(tile_plugins[tiles[i].id].initFunc):fetchPlugin(tiles[i].id))}function fetchPlugin(e){var i="tile_plugins/"+e+"/index.js";$.getScript(i,function(i,l,t){tile_plugins[e].initFunc=i})}function setStyles(){$(".tile.small").css({width:small_tile_size,height:small_tile_size}),$(".tile.medium").css({width:medium_tile_size,height:medium_tile_size}),$(".tile.big").css({width:big_tile_size,height:big_tile_size}),$(".tile.rectangle").css({width:big_tile_size,height:medium_tile_size}),$(".tile .fontIcon").each(function(){var e=$(this).closest(".tile").height();$(this).css({"font-size":e/2+"px","margin-top":e/8+"px"})})}function wakeUpLive(){var e=["slideInDown","slideInLeft","slideInRight","slideInUp","rotateIn","rollIn","zoomIn"],i=["fadeIn"];$(".tile .live").each(function(){var l=$(this).closest(".tile").attr("id"),t=tiles[l].liveImgUrls,s=tiles[l].liveTxts;if(null!=t&&t.length>1){var o=0,n=t.length,a="",r=2500+Math.round(Math.random()*(5e3/n));!function i(){tileMovementAllowed||tileResizeAllowed||(o=(o+1)%n,a=e[Math.floor(Math.random()*e.length)],$("#"+l).find(".fontImg").attr("src",t[o]).removeClass().addClass("fontImg animated "+a)),setTimeout(i,r)}()}if(null!=s&&s.length>1){var d=0,c=s.length;a="",r=2500+Math.round(Math.random()*(5e3/c));!function e(){tileMovementAllowed||tileResizeAllowed||(d=(d+1)%c,a=i[Math.floor(Math.random()*i.length)],$("#"+l).find(".liveTxt").text(s[d]).removeClass().addClass("liveTxt animated "+a)),setTimeout(e,r)}()}})}function calculateWidths(){var e=containerWidth-20;page_Width_Class="xs";gridsPerRow=config.gridCapacityPerRow||12,small_tile_size=Math.floor(e/gridsPerRow),e>=1200?(page_Width_Class="lg",gridsPerRow=config.gridCapacityPerRow||16,small_tile_size=Math.floor(e/gridsPerRow)):e>=992?(page_Width_Class="md",gridsPerRow=config.gridCapacityPerRow||12):e>=768?(page_Width_Class="sm",gridsPerRow=config.gridCapacityPerRow||12):(page_Width_Class="xs",gridsPerRow=config.gridCapacityPerRow||4,small_tile_size=Math.floor((e+20)/gridsPerRow)),medium_tile_size=2*small_tile_size,big_tile_size=4*small_tile_size}function noBigTileInXS(){if("xs"==page_Width_Class)for(var e in tiles)tiles[e].size="big"==tiles[e].size?"medium":tiles[e].size}function makeGrids(){for(var e in fillCapacity=0,tiles)"small"==tiles[e].size?fillCapacity+=1:"medium"==tiles[e].size?fillCapacity+=4:"rectangle"==tiles[e].size?fillCapacity+=8:"big"==tiles[e].size&&(fillCapacity+=16);var i=gridsPerRow*Math.ceil(fillCapacity/gridsPerRow)*2;grids={};var l=0,t=1;for(e=1;e<=i;e++){++l>gridsPerRow&&(l=1,t++);var s={};s.indX=l,s.indY=t,s.id=l+"x"+t,s.occupiedBy="none",s.top=(t-1)*small_tile_size,s.left=(l-1)*small_tile_size,s.type="",grids[s.id]=s}}function resetGrids(){for(var e in grids)grids[e].occupiedBy="none",grids[e].type=""}function mapTilesToGrid(){clearSpaceDivPosition=0;var e="";for(var i in tileOrder)e=tileOrder[i],gridId=placeTileOnGrid(tiles[e]),tiles[e].gridId=gridId,tiles[e].width="small"==tiles[e].size?small_tile_size:"medium"==tiles[e].size?medium_tile_size:big_tile_size,tiles[e].height="small"==tiles[e].size?small_tile_size:"big"==tiles[e].size?big_tile_size:medium_tile_size,tiles[e].bgColor=tiles[e].bgColor||colorCodes[Math.floor(Math.random()*colorCodes.length)],tiles[e].top=grids[gridId].top,tiles[e].left=grids[gridId].left,clearSpaceDivPosition=tiles[e].top+tiles[e].height>clearSpaceDivPosition?tiles[e].top+tiles[e].height:clearSpaceDivPosition}function placeTileOnGrid(e){for(var i in grids)if("none"==grids[i].occupiedBy){if("small"==e.size)return grids[i].occupiedBy=e.id,grids[i].type="startGrid",i;if(canItHoldTile(grids[i].id,e.size))return markGridsOccupied(grids[i].id,e.size,e.id),grids[i].type="startGrid",i}console.log("No Grid Avaialble for Tile id="+e.id)}function canItHoldTile(e,i){for(var l="medium"==i?2:4,t="big"==i?4:2,s=grids[e].indX,o=grids[e].indY,n=s+(l-1),a=o+(t-1),r="",d=!1,c=s;c<=n;c++){for(var g=o;g<=a;g++)if(null==grids[r=c+"x"+g]||null==typeof grids[r]||"none"!=grids[r].occupiedBy){d=!0;break}if(d)break}return!d}function markGridsOccupied(e,i,l){for(var t="medium"==i?2:4,s="big"==i?4:2,o=grids[e].indX,n=grids[e].indY,a=o+(t-1),r=n+(s-1),d=o;d<=a;d++)for(var c=n;c<=r;c++)grids[d+"x"+c].occupiedBy=l}function bindDragAndDrop(){var e=null,i=null,l=!1,t=0,s=0;container.on("pointerdown",".tile",function(i){container.hasClass("movementMode")&&(i.preventDefault(),l||(e=$(this).attr("id"),l=!0,t=i.pageX,s=i.pageY,container.find(".tile").removeClass("being-dragged"),$(this).addClass("being-dragged")))}),$("body").on("pointerup",function(t){if(l){if(l=!1,$("body").trigger("click"),null!=i&&null!=e){var s=[];for(var o in tileOrder)tileOrder[o]!=e&&(tileOrder[o]==i?(s.push(e),s.push(i)):s.push(tileOrder[o]));s.length!=tileOrder.length?(console.log("length mismatch... Hence this order cannot be taken..."),console.log("current tile order"),console.log(tileOrder),console.log("new tile order"),console.log(s)):tileOrder=s}reTilefy(),e=null,i=null,$(".tile").removeClass("being-dragged")}}),container.on("pointerout",function(e){$("body").trigger("pointerup")}),$("body").on("pointermove",function(o){if(o.stopPropagation(),tileMovementAllowed&&l&&null!=e){var n=o.pageX-t,a=o.pageY-s;t=o.pageX,s=o.pageY;var r=parseInt($("#"+e).css("left")),d=parseInt($("#"+e).css("top")),c=d+a,g=r+n;for(var f in tiles)if(e!=tiles[f].id&&Math.abs(tiles[f].left-r)<small_tile_size&&Math.abs(tiles[f].top-d)<small_tile_size){container.find(".tile").removeClass("shift-effect"),i=tiles[f].id,$("#"+i).addClass("shift-effect");break}$("#"+e).css({top:c,left:g})}}),$("#"+config.btn_ID_to_Toggle_Tile_Movement).on("click",function(){$(".tileResizeMenu").remove(),$("#"+config.btn_ID_to_Toggle_Tile_Movement).hasClass("on")?($("#"+config.btn_ID_to_Toggle_Tile_Movement).removeClass("on").addClass("off"),tileMovementAllowed=!1,container.removeClass("movementMode"),reTilefy()):($("#"+config.btn_ID_to_Toggle_Tile_Movement).removeClass("off").addClass("on"),tileMovementAllowed=!0,container.addClass("movementMode").removeClass("resizeMode"),tileResizeAllowed=!1,$("#"+config.btn_ID_to_Toggle_Tile_Resize).removeClass("on").addClass("off"))})}function enableTileResize(){$("#"+config.btn_ID_to_Toggle_Tile_Resize).on("click",function(){$(".tileResizeMenu").remove(),$("#"+config.btn_ID_to_Toggle_Tile_Resize).hasClass("on")?($("#"+config.btn_ID_to_Toggle_Tile_Resize).removeClass("on").addClass("off"),tileResizeAllowed=!1,container.removeClass("resizeMode")):($("#"+config.btn_ID_to_Toggle_Tile_Resize).removeClass("off").addClass("on"),tileResizeAllowed=!0,container.addClass("resizeMode").removeClass("movementMode"),tileMovementAllowed=!1,$("#"+config.btn_ID_to_Toggle_Tile_Movement).removeClass("on").addClass("off"),reTilefy())});container.on("click",".tile",function(e){if(container.hasClass("resizeMode")){$(".tileResizeMenu").remove();var i=parseInt($(this).css("top"))+20,l=parseInt($(this).css("left"))+20;$('<ul class="tileResizeMenu"><li>Small</li><li>Medium</li><li>Big</li><li>Rectangle</li></ul>').attr("data-tileID",$(this).attr("id")).css({top:i,left:l}).appendTo(container)}}),container.on("click",".tileResizeMenu li",function(e){var i=$(this).text().toLowerCase(),l=$(this).closest(".tileResizeMenu").attr("data-tileID");tiles[l].size!=i&&(tiles[l].size=i,reTilefy())})}init(),$("body").on("click",".tile a",function(e){(tileMovementAllowed||tileResizeAllowed)&&e.preventDefault()})})}}(jQuery);