!function(){angular.module("barickOSApp",["ngRoute","ngTouch"]).directive("tileAnimator",["$timeout","$rootScope",function(e,i){return{restrict:"E",controller:["$scope",function(t){function l(){i.flags.tileMovementAllowed||i.flags.tileResizingAllowed||(t.currImgIndex=(t.currImgIndex+1)%t.tile.liveImgUrls.length,t.AnimateClass=o[Math.floor(Math.random()*o.length)]),t.tile.liveImgUrls.length>1&&e(l,n)}t.currImgIndex=0,t.AnimateClass="bounce";var o=["slideInDown","slideInLeft","slideInRight","slideInUp","rotateIn","rollIn","zoomIn"],n=2500+Math.round(Math.random()*(5e3/t.tile.liveImgUrls.length));l()}],templateUrl:"partials/tileAnimator.html"}}]).service("tileManager",function(){function e(){var e=17,i=angular.element(".tiles-container").width()-e;c="xs";f=12,p=Math.floor(i/f),i>=1200?(c="lg",f=16,p=Math.floor(i/f)):i>=992?c="md":i>=768?c="sm":(c="xs",f=4,p=Math.floor((i+e)/f)),u=2*p,v=2*u}function i(){if("xs"==c)for(var e in s)s[e].size="big"==s[e].size?"medium":s[e].size}function t(){fillCapacity=0;for(var e in s)"small"==s[e].size?fillCapacity+=1:"medium"==s[e].size?fillCapacity+=4:"rectangle"==s[e].size?fillCapacity+=8:"big"==s[e].size&&(fillCapacity+=16);var i=f*Math.ceil(fillCapacity/f)*2;g={};for(var t=0,l=1,e=1;i>=e;e++){t++,t>f&&(t=1,l++);var o={};o.indX=t,o.indY=l,o.id=t+"x"+l,o.occupiedBy="none",o.top=(l-1)*p,o.left=(t-1)*p,o.type="",g[o.id]=o}}function l(){for(var e in g)g[e].occupiedBy="none",g[e].type=""}function o(){h=0;var e="";for(var i in d)e=d[i],gridId=n(s[e]),s[e].gridId=gridId,s[e].width="small"==s[e].size?p:"medium"==s[e].size?u:v,s[e].height="small"==s[e].size?p:"big"==s[e].size?v:u,s[e].bgColor=s[e].bgColor||m[Math.floor(Math.random()*m.length)],s[e].top=g[gridId].top,s[e].left=g[gridId].left,h=s[e].top+s[e].height>h?s[e].top+s[e].height:h}function n(e){for(var i in g)if("none"==g[i].occupiedBy){if("small"==e.size)return g[i].occupiedBy=e.id,g[i].type="startGrid",i;if(r(g[i].id,e.size))return a(g[i].id,e.size,e.id),g[i].type="startGrid",i}console.log("No Grid Avaialble for Tile id="+e.id)}function r(e,i){for(var t="medium"==i?2:4,l="big"==i?4:2,o=g[e].indX,n=g[e].indY,r=o+(t-1),a=n+(l-1),d="",s=!1,f=o;r>=f;f++){for(var c=n;a>=c;c++)if(d=f+"x"+c,void 0==g[d]||void 0==typeof g[d]||"none"!=g[d].occupiedBy){s=!0;break}if(s)break}return!s}function a(e,i,t){for(var l="medium"==i?2:4,o="big"==i?4:2,n=g[e].indX,r=g[e].indY,a=n+(l-1),d=r+(o-1),s="",f=n;a>=f;f++)for(var c=r;d>=c;c++)s=f+"x"+c,g[s].occupiedBy=t}var d=[],s={},g={},f=0,c="xs",p=0,u=0,v=0,h=200,m=["#632F00","#B01E00","#C1004F","#4617B4","#008287","#199900","#00C13F","#FF2E12","#FF1D77","#AA40FF","#1FAEFF","#000","#00A3A3","#FE7C22"];this.tilify=function(l){return s=l.tiles,d=l.tileOrder,e(),i(),t(),o(),l.tiles=s,l.tileOrder=d,l},this.reTilify=function(e){return s=e.tiles,d=e.tileOrder,console.log("tileOrder: "+JSON.stringify(d)),l(),o(),e.tiles=s,e.tileOrder=d,e},this.getClearSpaceDivPosition=function(){return h},this.getGrids=function(){return g}}).controller("mainCtrl",["$scope","$rootScope",function(e,i){i.flags={},i.flags.tileOpInProg=!1,i.flags.tileResizingAllowed=!1,i.flags.tileMovementAllowed=!1,e.toggleTileResize=function(e){e.stopPropagation(),i.flags.tileResizingAllowed=!i.flags.tileResizingAllowed,i.flags.tileMovementAllowed=!1},e.toggleTileMove=function(e){e.stopPropagation(),i.flags.tileMovementAllowed&&i.$broadcast("tileMovementEnd"),i.flags.tileMovementAllowed=!i.flags.tileMovementAllowed,i.flags.tileResizingAllowed=!1}}]).controller("tilesCtrl",["$scope","$http","$rootScope","tileManager",function(e,i,t,l){var o;i.get("data/TM.json").then(function(i){var t=i.data;e.TM=l.tilify(t),o=l.getGrids()},function(e){console.log(e)}),e.getClearSpaceDivPosition=l.getClearSpaceDivPosition,e.$on("tileMovementEnd",function(){e.TM=l.reTilify(e.TM)}),e.tileClicked=function(e,i){return t.flags.tileMovementAllowed||t.flags.tileResizingAllowed?void e.preventDefault():void 0};var n=0;e.tileTouchStart=function(e){return t.flags.tileMovementAllowed||t.flags.tileResizingAllowed?(e.preventDefault(),void(n=0)):void(n=(new Date).getTime())},e.tileTouchEnd=function(e,i){var l=(new Date).getTime(),o=l-n;return console.log("timeDiff="+o),n=0,t.flags.tileMovementAllowed||t.flags.tileResizingAllowed?void e.preventDefault():(o>500&&(console.log("here"),window.location.href=i),void(n=0))};var r=["small","medium","rectangle","big"];e.nextSize=function(i){var t=e.TM,o=t.tiles[i].size,n=(r.indexOf(o)+1)%r.length,a=r[n];t.tiles[i].size=a,e.TM=l.reTilify(t)};var a=0,d=0;e.dto=null,e.sto=null;var s=[];e.dragStart=function(i,l){!t.flags.tileOpInProg&&t.flags.tileMovementAllowed&&(t.flags.tileOpInProg=!0,i.stopPropagation(),i.pageX=i.pageX||i.originalEvent.changedTouches[0].pageX,i.pageY=i.pageY||i.originalEvent.changedTouches[0].pageY,a=i.pageX,d=i.pageY,e.dto=e.TM.tiles[l],e.dto.zIndex=1100)},e.dragEnd=function(i){if(t.flags.tileOpInProg&&t.flags.tileMovementAllowed&&(i.stopPropagation(),null!=e.dto)){if(null!=e.sto){if(n=e.TM.tileOrder.indexOf(e.dto.id),s=[],1==Math.abs(e.TM.tileOrder.indexOf(e.dto.id)-e.TM.tileOrder.indexOf(e.sto.id))){s=e.TM.tileOrder;var n=e.TM.tileOrder.indexOf(e.sto.id),r=e.TM.tileOrder.indexOf(e.dto.id);s[n]=e.dto.id,s[r]=e.sto.id}else for(var a in e.TM.tileOrder)e.TM.tileOrder[a]!=e.dto.id&&(e.TM.tileOrder[a]==e.sto.id?(s.push(e.dto.id),s.push(e.sto.id)):s.push(e.TM.tileOrder[a]));var d=e.TM;d.tileOrder=s,e.TM=l.reTilify(d)}else dto.top=o[dto.gridId].top,dto.left=o[dto.gridId].left;e.dto=null,e.sto=null,t.flags.tileOpInProg=!1}},e.dragMove=function(i){if(t.flags.tileOpInProg&&t.flags.tileMovementAllowed){i.stopPropagation(),i.preventDefault(),i.pageX=i.pageX||i.originalEvent.changedTouches[0].pageX,i.pageY=i.pageY||i.originalEvent.changedTouches[0].pageY;var l=i.pageX-a,o=i.pageY-d;a=i.pageX,d=i.pageY;var n=e.dto.left+l,r=e.dto.top+o;for(var s in e.TM.tiles){var g=e.TM.tiles[s];if(e.dto.id!=g.id&&Math.abs(g.left-e.dto.left)<g.width/2&&Math.abs(g.top-e.dto.top)<g.height/2){e.sto=g;break}}e.dto.top=r,e.dto.left=n}},e.dragEnd=function(i){if(t.flags.tileOpInProg&&t.flags.tileMovementAllowed&&null!=e.dto&&null!=e.sto){i.stopPropagation();var o=[];for(var n in e.TM.tileOrder)e.TM.tileOrder[n]!=e.dto.id&&(e.TM.tileOrder[n]==e.sto.id?(o.push(e.dto.id),o.push(e.sto.id)):o.push(e.TM.tileOrder[n]));e.dto=null,e.sto=null;var r=e.TM;r.tileOrder=o,e.TM=l.reTilify(r),t.flags.tileOpInProg=!1}}}]).config(["$routeProvider","$locationProvider",function(e,i){i.html5Mode(!1),i.hashPrefix("!"),e.when("/desktop",{templateUrl:"partials/tiles.html",controller:"tilesCtrl"}).when("/",{redirectTo:"/desktop"}).otherwise({redirectTo:"/"})}])}();